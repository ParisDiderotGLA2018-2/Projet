<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Maps Event</title>
<!-- 
Journey Template 
http://www.templatemo.com/tm-511-journey
-->
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">  <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">                <!-- Font Awesome -->
    <link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
    <link rel="stylesheet" type="text/css" href="css/datepicker.css"/>
    <link rel="stylesheet" type="text/css" href="slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>
    <link rel="stylesheet" href="css/templatemo-style.css">                                   <!-- Templatemo style -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
            <!--[if lt IE 9]>
              <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
              <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
      </head>

      <body>
        <div class="tm-main-content" id="top">
            <div class="tm-top-bar-bg"></div>    
            <div class="tm-top-bar" id="tm-top-bar">
                <div class="container">
                    <div class="row">
                        <nav class="navbar navbar-expand-lg narbar-light">
                            <a class="navbar-brand mr-auto" href="#tm-section-0">
                                <img src="img/logo.png" alt="Site logo">
                                MAPS Event
                            </a>
                            <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            
                           
                                <ul class="navbar-nav ml-auto">
                                 <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                                <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                                        
                                       <input name="destination" type="text" class="form-control" id="btnSearchfrd" placeholder="Name ...">
                                   
                                       
                                    </div>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Logout</a>
                                </li>
                            </ul>
                             

                </div>
                        </div>                            
                    </nav>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- .tm-top-bar -->

        <div class="tm-page-wrap mx-auto">
            <div class="tm-container-outer tm-position-relative" id="tm-section-0">
                      
                
                <div class="col-xs-8 mx-auto tm-about-text-wrap text-center" id="Xmap">     
                    <button  type="button" class="btn btn-primary" id="btnmymap">My Maps</button>
                       
                    <button type="submit" class="btn btn-primary" id="btnpubmap">Public Maps</button>
                        
                    <button type="submit" class="btn btn-primary" id="btnfrdmap">Friend's Maps</button>                                   
                </div>
                <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1" id="Searchmap">
                   <!--
                    <input name="destination" type="text" class="" id="btnSearchmap" placeholder="Search a Map ...">
                -->
                <div id="btnSearchmap">
                    <input id="address" type="textbox" value="search Map" >
                    <input id="submit" type="button" value="search">
                </div>
                </div>

                <div class="col-xs-12 mx-auto tm-about-text-wrap " id="btnmymapshow"> 
                    
                    <button onclick="setNewMap();" type="submit" class="btn btn-primary tm-btn-search " id="btnadd">Add map/place</button>
                   </br>
                    <button onclick="updateMap();" type="submit" class="btn btn-primary tm-btn-search " id="btnupdate">Update place</button>
                    </br>
                    <button onclick="deleteMarker();" type="submit" class="btn btn-primary tm-btn-search " id="btndelete">delete place</button>
                    
                                        
                </div>

                <div class="col-xs-12 mx-auto tm-about-text-wrap " id="btnpubmapshow"> 
                    
                    <button type="submit" class="btn btn-primary tm-btn-search " id="btnpubshared">Share</button>
                  
                                        
                </div>

                <div class="col-xs-12 mx-auto tm-about-text-wrap " id="btnfrdmapshow"> 
                    
                    <button type="submit" class="btn btn-primary tm-btn-search " id="btnfrdshared">Share</button>
                   
                                        
                </div>

                              
          

                <div id="google-map"></div>
                
            </div> <!-- .tm-container-outer -->
             <section class="p-5 tm-container-outer ">            
                <div class="container">
                    <div class="row" id ="Xmap">
                                                       
                    </div>
                    </div>
                </div>            
            </section>
            
            <div class="tm-container-outer" id="tm-section-2">

                <section class="tm-slideshow-section">
                    <div class="tm-slideshow">
                        <img src="img/paris1.jpg" alt="Image">
                        <img src="img/paris2.jpg" alt="Image">
                        <img src="img/paris3.jpg" alt="Image">    
                    </div>
                    <div class="tm-slideshow-description tm-bg-primary">
                        <h2 class="">Paris</h2>
                        <p>these are my favorite and most famousplaces in paris</p>
                        <a href="Omap.html" class="text-uppercase tm-btn tm-btn-white tm-btn-white-primary">Open Map</a>
                    </div>
                </section>
                <section class="clearfix tm-slideshow-section tm-slideshow-section-reverse">

                    <div class="tm-right tm-slideshow tm-slideshow-highlight">
                        <img src="img/stade1.jpg" alt="Image">
                        <img src="img/stade2.jpg" alt="Image">
                        <img src="img/stade3.jpg" alt="Image">
                    </div> 

                    <div class="tm-slideshow-description tm-slideshow-description-left tm-bg-highlight">
                        <h2 class="">football stadium</h2>
                        
                        <a href="#" class="text-uppercase tm-btn tm-btn-white tm-btn-white-highlight">Open Map</a>
                    </div>                        

                </section>
                <section class="tm-slideshow-section">
                    <div class="tm-slideshow">
                        <img src="img/plage1.jpg" alt="Image">
                        <img src="img/plage2.jpg" alt="Image">
                        <img src="img/plage3.jpg" alt="Image">
                    </div>
                    <div class="tm-slideshow-description tm-bg-primary">
                        <h2 class="">beach</h2>
                       
                        <a href="#" class="text-uppercase tm-btn tm-btn-white tm-btn-white-primary">Open Map</a>
                    </div>
                </section>
                <label></label>
                <a href="#" class="text-uppercase btn-primary tm-btn mx-auto tm-d-table">Show More maps</a>
                <label></label>
            <section class="tm-banner">
                <div class="tm-container-outer tm-banner-bg">
                    <div class="container">

                        <div class="row tm-banner-row tm-banner-row-header">
                            <div class="col-xs-12">
                                <div class="tm-banner-header">
                                    <h1 class="text-uppercase tm-banner-title"></h1>
                                    <img src="img/dots-3.png" alt="Dots">
                                          
                                </div>    
                            </div>  <!-- col-xs-12 -->                      
                        </div> <!-- row -->
                        <div class="row tm-banner-row" id="tm-section-search">

                            <form action="index.html" method="get" class="tm-search-form tm-section-pad-2">
                                <div class="form-row tm-search-form-row">                                
                                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                                        <label for="inputCity">Search a Map </label>
                                        <input name="destination" type="text" class="form-control" id="inputCity" placeholder="Name Map ...">
                                    </div>
                                    <div class="form-group tm-form-group tm-form-group-1">                                    
                                        <div class="form-group tm-form-group tm-form-group-pad tm-form-group-2">
                                            <label for="inputRoom"></label>
                                                                                  
                                        </div>
                                        <div class="form-group tm-form-group tm-form-group-pad tm-form-group-3">                                       
                                            <label for="inputAdult"></label>     
                                                                                   
                                        </div>
                                        <div class="form-group tm-form-group tm-form-group-pad tm-form-group-3">

                                            <label for="inputChildren"></label>                                            
                                                                                  
                                        </div>
                                    </div>
                                </div> <!-- form-row -->
                                <div class="form-row tm-search-form-row">

                                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-3">
                                        <label for="inputCheckIn"></label>
                                        <input name="check-in" type="text" class="form-control" id="inputCheckIn" placeholder="Beginning date">
                                    </div>
                                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-3">
                                        <label for="inputCheckOut"></label>
                                        <input name="check-out" type="text" class="form-control" id="inputCheckOut" placeholder="End date">
                                    </div>
                                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                                        <label for="btnSubmit">&nbsp;</label>
                                        <button type="submit" class="btn btn-primary tm-btn tm-btn-search text-uppercase" id="btnSubmit">Only From Friends</button>
                                        <label for="btnSubmit">&nbsp;</label>
                                        <button type="submit" class="btn btn-primary tm-btn tm-btn-search text-uppercase" id="btnSubmit">Public</button>

                                    </div>
                                </div>                              
                            </form>                             

                        </div> <!-- row -->
                        <div class="tm-banner-overlay"></div>
                    </div>  <!-- .container -->                   
                </div>     <!-- .tm-container-outer -->                 
            </section>

           
            </div>        
            
               <!--//1-->
                   

           
            <footer class="tm-container-outer">
                <p class="mb-0">Copyright © <span class="tm-current-year">2018</span> GL Tuesday G2 
                    
                . Designed by <a rel="nofollow" href="http://www.google.com/+templatemo" target="_parent">Template Mo</a></p>
            </footer>
        </div>
    </div> <!-- .main-content -->

    <!-- load JS files -->
    <script src="js/jquery-1.11.3.min.js"></script>             <!-- jQuery (https://jquery.com/download/) -->
    <script src="js/popper.min.js"></script>                    <!-- https://popper.js.org/ -->       
    <script src="js/bootstrap.min.js"></script>                 <!-- https://getbootstrap.com/ -->
    <script src="js/datepicker.min.js"></script>                <!-- https://github.com/qodesmith/datepicker -->
    <script src="js/jquery.singlePageNav.min.js"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
    <script src="slick/slick.min.js"></script>                  <!-- http://kenwheeler.github.io/slick/ -->
    <script src="js/jquery.scrollTo.min.js"></script>           <!-- https://github.com/flesler/jquery.scrollTo -->

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTm6ishw_vJww3HcbrHpRXMJNnMfZc3Ek&callback=initMap"></script>

    <script type="text/javascript" src="home.js"></script>
       
    
    <script> 


        /* Google Maps
        ------------------------------------------------*/
         var x=0;

        $(document).ready(function(){
            $("#btnpubmapshow").hide();
            $("#btnfrdmapshow").hide();

        getServerData("ws/index/mymap",initMap);
        

        $("#btnmymap").click(function(){
            $("#btnpubmapshow").hide();
            $("#btnfrdmapshow").hide();
            $("#btnmymapshow").show();
            
        });
        $("#btnpubmap").click(function(){
            $("#btnmymapshow").hide();
            $("#btnfrdmapshow").hide();
            $("#btnpubmapshow").show();
            
        });
        $("#btnfrdmap").click(function(){
            $("#btnpubmapshow").hide();
            $("#btnmymapshow").hide();
            $("#btnfrdmapshow").show();
            
        });

       
    });

        var map;
      var markers = [];
      var markerImage = 'marker.png';
      
      var infowindows =[];
      var detail =[]; 

      

      $(function(){
        $("#btnmymap").click(function(){
           getServerData("ws/index/mymap",initMap); 
        });
        
         $("#setNewmap").click(function(){
           getServerData("/ws/index/add",callDone); 
        });

        $("#btnadd").click(function(){
           getServerData("ws/index/add/listname",setNewMap); 
        });


        });

      function callDone(result){
   
       
        var  sr=200;

        sr=JSON.stringify(result);

        console.log(sr);
    
    //$("#result").append(sr);

        if(sr == "200"){
            window.location = "http://localhost:8088/index.html";
            
        }else{
             markers[markers.length-1].setMap(null);  
        }
    }
      

/*
    function callDone_setNewMap(result){
   

        console.log(result[].name);
        
     
    }*/

    //////////////////////////////////////////////////////////
    
        //$("#result").append(sr);
/*
        
        var EX=[{
                name : "PARIS",
                place : "Eiffel Tower",
                visibilite:"public",
                lt : 48.8583905296204,
                lg : 2.2944259643554688,
                msg : "the view from the topis just breathtaking",
                img : "img/paris1.jpg"

            },
            {
                name : "PARIS",
                place: "IKHAN",
                visibilite:"public",
                lt : 48.87386089807715,
                lg : 2.294940948486328,
                msg : "...................",
                img : "img/paris2.jpg"
            }
            ];
        */
            


      function initMap(result) {

        var paris={lat: 48.866667, lng: 2.333333};

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
             paris = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            map.setCenter(paris);
            addMarker1(paris);
          }, function() {
            handleLocationError(true,map.getCenter());

          });
        } else {
          
           handleLocationError(false,map.getCenter());
         
        }    

        map = new google.maps.Map(document.getElementById('google-map'), {
          center: paris,
          zoom: 12,
          panControl: false,
          scrollwheel: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });


        console.log(result.length);
        for(var j in result){

        console.log(result[j].name);
        console.log(result[j].creator.login);
        console.log(result[j].creator.password);
        console.log(result[j].visibilite);

        var ll=result[j].location;
        console.log(ll.length);
        var ji=0;
        for(var i in ll)
        {
             var d='<div id="detail" class="info-window">' +
                     '<div class="info-content">' +
                    '<h2>'+result[j].name+'</h2>'+
                    '<h3>'+ll[i].place+'</h3>'+
                    '<p>'+ll[i].msg+'</p>'+
                    '<div class="tm-slideshow">'+
                    '<img src="'+ll[i].filename+'" alt="Image">'+ 
                    '</div>'+
                    '</div>'+
                    '</div>';

            

            addInfoW(d);
            var lt=ll[i].lat;
            var lg=ll[i].lng;

            console.log(lt);
            console.log(ll[i].filename);

            var Pos={lat: lt, lng: lg};
            addMarker(Pos);
            
           markers[ji].addListener('click', function () {
            infowindows[ji].open(map, markers[ji]);
            });
        }
    }

     
       /* 
        addInfoW(detail1);
        addInfoW(detail2);
        
        addMarker(tour);
        addMarker(arc);
        addMarker(bercy);
        addMarker(barca);
        addMarker(munchen);
        
        markers[0].addListener('click', function () {
            infowindows[0].open(map, markers[0]);
        });
        markers[1].addListener('click', function () {
            infowindows[1].open(map, markers[1]);
        });
        */

        var geocoder = new google.maps.Geocoder();

        document.getElementById('submit').addEventListener('click', function() {
          geocodeAddress(geocoder, map);
        });



      }

      // Adds a marker to the map and push to the array.
      function addMarker(location) {
        var marker = new google.maps.Marker({
                position: location,
                map: map,
                icon: markerImage
               // title: "Vous êtes ici"
            });
     
        markers.push(marker);
      }
      function addInfoW(detail){

        var infowindow = new google.maps.InfoWindow({
            content: detail
        });
        infowindows.push(infowindow);
      }
      // Adds a marker to the map and push to the array.
      function addMarker1(location) {
        var marker = new google.maps.Marker({
                position: location,
                map: map
            });
      }

       function handleLocationError(browserHasGeolocation, pos) {
        addMarker1(pos);
       
      }

     

      function setNewMap(result){

       
     
        var d="";

        for (var i = 0; i < result.length-1; i++) {
                    d+='<option value="">'+result[i]+'</option>';
                    }
        map.addListener('click', function(event) {
            var myLatLng = event.latLng;
           
          addMarker(myLatLng);
        
           var detail1 = '<div class="info-window">' +
                '<div class="info-content">' +
                
                '<form action="ws/index/add" method="GET">'+
                '<label>My map </label>'+
                    '<select name="map" id="smap" onchange="change_valeur();">'+
                    '<option value=""></option>'
                    +d+
                    '</select><br/>'+
                    '<label>map\'s name</label>'+
                      '<input type="text" name="name" id="sname" ><br>'+
                      '<label>tag</label>'+
                      '<input type="text" name="tag"><br>'+
                      '<label>place name</label>'+
                      '<input type="text" name="place" ><br>'+
                      '<input type="text" name="lat"  value="'+event.latLng.lat()+'">'+
                      '<input type="text" name="lng"  value="'+event.latLng.lng()+'"><br/>'+
                      '<label>description </label>'+
                      '<textarea name="msg" rows="2" cols="30"></textarea></br>'+
                      '<label>upload picture</label>'+
                      '<input type="file" id=""></br>'+
                      '<select name="visib">'+
                    '<option value="public">Public</option>'+
                    '<option value="friend">Friend</option>'+
                    '<option value="private">Private</option>'+
                    '</select><br/>'+
                      '<button type="submit" class="btn btn-primary tm-btn-search " id="setNewmap">Submit</button>'+
                    '</form>'+ 
                '</div>' +
                '</div>';

                var infowindow = new google.maps.InfoWindow({
                    content: detail1,

                });
        
            infowindow.open(map, markers[parseInt( result[result.length-1] )] );

         });      
         console.log(parseInt( result[result.length-1] )); 

        
        
      }


    
    function change_valeur() {
        select = document.getElementById("smap");
        choice = select.selectedIndex;
        texte = select.options[choice].text;
        document.getElementById('sname').value = texte;
    }

      function updateMap(){

        map.addListener('click', function(event) {
            var myLatLng = event.latLng;
            var a=0;
            //recupere le tab exact 
            for( var i in EX )
            {
                a++;
                var LatLng ={ lat : EX[i].lt ,lng : EX[i].lg};
                if(_.isEqual(myLatLng, LatLng)){

                var detail1 = '<div class="info-window">' +
                    '<div class="info-content">' +
                    
                    '<form>'+
                    '<label>My map </label>'+
                        '<select name="map">'+
                        '<option value="paris">'+EX[i].name+'</option>'+
                        '</select><br/>'+
                        '<label>map\'s name</label>'+
                          '<input type="text" name=""  value="'+EX[i].name+'"><br>'+
                          '<label>tag</label>'+
                          '<input type="text" name="" ><br>'+
                          '<label>place name</label>'+
                          '<input type="text" name="" value="'+EX[i].place+'"><br>'+
                          '<label>description </label>'+
                          '<textarea rows="2" cols="30">'+EX[i].msg+'</textarea></br>'+
                          '<label>upload picture</label>'+
                          '<input type="file" id="myFile" vaue="'+EX[i].img+'"></br>'+
                          '<input type="file" id="visibilite" vaue="'+EX[i].visibilite+'"></br>'+
                          '<select name="">'+
                        '<option value="">Public</option>'+
                          '<option value="">Friend</option>'+
                        '<option value="">Private</option>'+
                        '</select><br/>'+
                          '<input type="submit" value="Submit">'+
                         
                        '</form>'+ 
                    '</div>' +
                    '</div>';

                var infowindow = new google.maps.InfoWindow({
                    content: detail1,
                });

                // i et la position exact !!!
                infowindow.open(map, markers[0]);

                }
                
            }
        

        });


      }
 
      function deleteMarker() {
        markers[0].addListener('click', function () {
            markers[0].setMap(null);
        });
      }

        function geocodeAddress(geocoder, resultsMap) {
        var address = document.getElementById('address').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
              map: resultsMap,
              position: results[0].geometry.location
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }
      






       
        /*
         DOM is ready
        ------------------------------------------------
        */
         
        //button top
 $(function(){

            

            // Change top navbar on scroll
            $(window).on("scroll", function() {
                if($(window).scrollTop() > 100) {
                    $(".tm-top-bar").addClass("active");
                } else {                    
                 $(".tm-top-bar").removeClass("active");
                }
            });

            // Smooth scroll to search form
            $('.tm-down-arrow-link').click(function(){
                $.scrollTo('#tm-section-search', 300, {easing:'linear'});
            });

            // Date Picker in Search form
            var pickerCheckIn = datepicker('#inputCheckIn');
            var pickerCheckOut = datepicker('#inputCheckOut');

            // Update nav links on scroll
            $('#tm-top-bar').singlePageNav({
                currentClass:'active',
                offset: 60
            });

            // Close navbar after clicked
            $('.nav-link').click(function(){
                $('#mainNav').removeClass('show');
            });

            // Slick Carousel
            $('.tm-slideshow').slick({
                infinite: true,
                arrows: true,
                slidesToShow: 1,
                slidesToScroll: 1
            });

            //Google Map 
            //loadGoogleMap();    

    

                                                      
            $('.tm-current-year').text(new Date().getFullYear());  //Update year in copyright           
        });

     
    </script>             



</body>
</html>